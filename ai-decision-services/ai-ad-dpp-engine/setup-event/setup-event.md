Lab 7: Configure OCI Events
===

OCI Events tracks resource changes with events which comply with CNCF CloudEvents Standard. 
1. Go to Events Service → Rules → Create Rule, and create a rule as follows:  
![](./images/Set-Ev2.png)

*   For Event Type, choose **Object Storage**, choosing **Object - Create** and **Object - Update**.
*   For Attribute, choose **bucketName**. Attribute Values should be **training-data-bucket** and **inferencing-data-bucket**, which were the values set up in Lab 4 earlier.
    
2.  For Actions, choose **Functions** as action type, and select the right compartment, application and Function OCID provisioned in Lab 7.

The finalized Rule Logic is shown below:

```java
MATCH event WHERE (
  eventType EQUALS ANY OF (
    com.oraclecloud.objectstorage.updateobject,
    com.oraclecloud.objectstorage.createobject
  )
  AND (
    bucketName MATCHES ANY OF (
      training-data-bucket,
      inferencing-data-bucket
    )
  )
)
```

  

A sample event generated by object upload is shown below just for reference:

```java
{
  "eventType" : "com.oraclecloud.objectstorage.updateobject",
  "cloudEventsVersion" : "0.1",
  "eventTypeVersion" : "2.0",
  "source" : "ObjectStorage",
  "eventTime" : "2022-08-24T18:45:39Z",
  "contentType" : "application/json",
  "data" : {
    "compartmentId" : "<compartment_ocid>",
    "compartmentName" : "<compartment_name>",
    "resourceName" : "<dataset_name>",
    "resourceId" : "<resource_id>",
    "availabilityDomain" : "PHX-AD-1",
    "additionalDetails" : {
      "bucketName" : "<bucket_name>",
      "versionId" : "<version_id>",
      "archivalState" : "Available",
      "namespace" : "<namespace>",
      "bucketId" : "<bucket_ocid>",
      "eTag" : "<etag>"
    }
  },
  "eventID" : "<event_id>",
  "extensions" : {
    "compartmentId" : "<compartment_id>"
  }
}
```

Finally, enable logs for troubleshooting purpose.

![](./images/Set-Ev1.png)

## Next steps
Use the links to learn more about DB and Object Storage events which OCI Events Service can monitor: [ADB]((https://docs.oracle.com/en-us/iaas/Content/Events/Reference/eventsproducers.htm#dbaasevents__AutoDB)), [Object Storage](https://docs.oracle.com/en-us/iaas/Content/Events/Reference/eventsproducers.htm#ObjectStor__bucket).
